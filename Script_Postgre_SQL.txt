CREATE TABLE PROVIDER (
	id int PRIMARY KEY,
	name varchar(50),
	address varchar(50)
)
________________________________________________________________________________________________
CREATE TABLE PRODUCT (
	id int PRIMARY KEY,
	name varchar(50),
	price int,
	image varchar(50),
	status int,
	provider int REFERENCES PROVIDER(id)
)
________________________________________________________________________________________________
CREATE or replace FUNCTION getProviders()
RETURNS SETOF PROVIDER AS
$BODY$
DECLARE
    reg RECORD;
BEGIN
    FOR REG IN SELECT id,name,address FROM PROVIDER LOOP
       RETURN NEXT reg;
    END LOOP;
    RETURN;
END
$BODY$ LANGUAGE 'plpgsql'
________________________________________________________________________________________________
insert into PROVIDER values (1,'Extremetech','Cartago')

insert into PRODUCT values (8,'Martillo',5200,'Es un martillo','martillo.png',1,2)

________________________________________________________________________________________________


CREATE or replace FUNCTION getProducts(p_id int)
RETURNS SETOF PRODUCT AS
$BODY$
DECLARE
    reg RECORD;
BEGIN
    FOR REG IN SELECT id,name,price,description,image,status,provider FROM PRODUCT WHERE provider = p_id ORDER BY id LOOP
       RETURN NEXT reg;
    END LOOP;
    RETURN;
END
$BODY$ LANGUAGE 'plpgsql'
________________________________________________________________________________________________

CREATE or replace FUNCTION updateProductStatus(p_provider int, p_product int , p_status int)
RETURNS void AS
$BODY$
BEGIN
   UPDATE PRODUCT SET status = p_status WHERE id = p_product AND provider = p_provider;
END;
$BODY$ 
LANGUAGE 'plpgsql'

________________________________________________________________________________________________

